const authPanel = document.getElementById("auth-panel");
const loginForm = document.getElementById("login-form");
const usernameInput = document.getElementById("username-input");
const passwordInput = document.getElementById("password-input");
const loginErrorEl = document.getElementById("login-error");
const userStatusLabel = document.getElementById("user-status-label");
const logoutBtn = document.getElementById("logout-btn");
const changePasswordBtn = document.getElementById("change-password-btn");
const userRoleLabel = document.getElementById("user-role-label");

const studentDashboard = document.getElementById("student-dashboard");
const adminPanel = document.getElementById("admin-panel");
const refreshSessionsBtn = document.getElementById("refresh-sessions");
const sessionHistoryList = document.getElementById("session-history");
const studentTopControls = document.getElementById("student-top-controls");

const adminStudentList = document.getElementById("admin-student-list");
const adminStudentMeta = document.getElementById("admin-student-meta");
const adminSessionList = document.getElementById("admin-session-list");
const adminSessionScenario = document.getElementById("admin-session-scenario");
const adminSessionConversation = document.getElementById("admin-session-conversation");
const adminSessionEvaluation = document.getElementById("admin-session-evaluation");
const adminAssignmentList = document.getElementById("admin-assignment-list");
const adminAssignmentForm = document.getElementById("admin-assignment-form");
const adminAssignmentStatus = document.getElementById("admin-assignment-status");
const adminAssignmentIdInput = document.getElementById("admin-assignment-id");
const adminAssignmentTitle = document.getElementById("admin-assignment-title");
const adminAssignmentDescription = document.getElementById("admin-assignment-description");
const adminAssignmentDifficulty = document.getElementById("admin-assignment-difficulty");
const adminAssignmentChapter = document.getElementById("admin-assignment-chapter");
const adminAssignmentSection = document.getElementById("admin-assignment-section");
const adminAssignmentBlueprint = document.getElementById("admin-assignment-blueprint");
const adminAssignmentScenario = document.getElementById("admin-assignment-scenario");
const adminAssignmentScenarioHost = document.getElementById(
  "admin-assignment-scenario-editor",
);
const adminAssignmentStudents = document.getElementById("admin-assignment-students");
const adminAssignmentGenerateBtn = document.getElementById("admin-assignment-generate");
const adminAssignmentGeneratorStatus = document.getElementById("admin-assignment-generator-status");
const adminBlueprintList = document.getElementById("admin-blueprint-list");
const adminBlueprintForm = document.getElementById("admin-blueprint-form");
const adminBlueprintStatus = document.getElementById("admin-blueprint-status");
const adminBlueprintIdInput = document.getElementById("admin-blueprint-id");
const adminBlueprintTitle = document.getElementById("admin-blueprint-title");
const adminBlueprintSummary = document.getElementById("admin-blueprint-summary");
const adminBlueprintStudentRole = document.getElementById("admin-blueprint-student-role");
const adminBlueprintAiRole = document.getElementById("admin-blueprint-ai-role");
const adminBlueprintStudentCompanyName = document.getElementById("admin-blueprint-student-company-name");
const adminBlueprintStudentCompanyProfile = document.getElementById("admin-blueprint-student-company-profile");
const adminBlueprintAiCompanyName = document.getElementById("admin-blueprint-ai-company-name");
const adminBlueprintAiCompanyProfile = document.getElementById("admin-blueprint-ai-company-profile");
const adminBlueprintAiRules = document.getElementById("admin-blueprint-ai-rules");
const adminBlueprintProductName = document.getElementById("admin-blueprint-product-name");
const adminBlueprintProductSpecs = document.getElementById("admin-blueprint-product-specs");
const adminBlueprintProductQuantity = document.getElementById("admin-blueprint-product-quantity");
const adminBlueprintStudentPrice = document.getElementById("admin-blueprint-student-price");
const adminBlueprintAiBottom = document.getElementById("admin-blueprint-ai-bottom");
const adminBlueprintMarket = document.getElementById("admin-blueprint-market");
const adminBlueprintTimeline = document.getElementById("admin-blueprint-timeline");
const adminBlueprintLogistics = document.getElementById("admin-blueprint-logistics");
const adminBlueprintNegotiationTargets = document.getElementById("admin-blueprint-negotiation-targets");
const adminBlueprintRisks = document.getElementById("admin-blueprint-risks");
const adminBlueprintChecklist = document.getElementById("admin-blueprint-checklist");
const adminBlueprintKnowledge = document.getElementById("admin-blueprint-knowledge");
const adminBlueprintOpening = document.getElementById("admin-blueprint-opening");
const adminBlueprintDifficulty = document.getElementById("admin-blueprint-difficulty");
const adminBlueprintReset = document.getElementById("admin-blueprint-reset");
const adminBlueprintGenerateBtn = document.getElementById("admin-blueprint-generate");
const adminBlueprintGeneratorStatus = document.getElementById("admin-blueprint-generator-status");
const adminBlueprintChapter = document.getElementById("admin-blueprint-chapter");
const adminBlueprintSection = document.getElementById("admin-blueprint-section");
const adminStudentImportForm = document.getElementById("admin-student-import-form");
const adminStudentImportFile = document.getElementById("admin-student-import-file");
const adminStudentImportStatus = document.getElementById("admin-student-import-status");
const adminStudentPasswordForm = document.getElementById("admin-student-password-form");
const adminStudentPasswordInput = document.getElementById("admin-student-new-password");
const adminStudentPasswordStatus = document.getElementById("admin-student-password-status");
const adminProfileForm = document.getElementById("admin-profile-form");
const adminProfileNameInput = document.getElementById("admin-profile-name");
const adminProfileStatus = document.getElementById("admin-profile-status");
const adminPasswordForm = document.getElementById("admin-password-form");
const adminPasswordCurrent = document.getElementById("admin-password-current");
const adminPasswordNew = document.getElementById("admin-password-new");
const adminPasswordStatus = document.getElementById("admin-password-status");
const studentAssignmentListEl = document.getElementById("student-assignment-list");
const studentAssignmentStatus = document.getElementById("student-assignment-status");
const studentPasswordForm = document.getElementById("student-password-form");
const studentPasswordCurrent = document.getElementById("student-password-current");
const studentPasswordNew = document.getElementById("student-password-new");
const studentPasswordStatus = document.getElementById("student-password-status");

const levelSelectionPanel = document.getElementById("level-selection-panel");
const levelMapContainer = document.getElementById("level-map");
const selectedLevelDetail = document.getElementById("selected-level-detail");
const selectedLevelTitle = document.getElementById("selected-level-title");
const selectedLevelDescription = document.getElementById("selected-level-description");
const startLevelBtn = document.getElementById("start-level");
const startAssignmentBtn = document.getElementById("start-assignment");
const difficultySelect = document.getElementById("difficulty-select");
const loadingPanel = document.getElementById("loading-panel");
const experienceSection = document.getElementById("experience");
const studentOptionButtons = document.querySelectorAll("[data-student-option]");
const studentModalOverlay = document.getElementById("student-modal-overlay");
const studentModal = document.getElementById("student-modal");
const studentModalCloseBtn = document.getElementById("student-modal-close");
const studentModalTabButtons = document.querySelectorAll("#student-modal [data-modal-tab]");
const studentModalPanels = document.querySelectorAll("#student-modal [data-modal-panel]");
const studentPasswordModal = document.getElementById("student-password-modal");
const studentPasswordModalClose = document.getElementById("student-password-modal-close");
const adminTabButtons = document.querySelectorAll("#admin-panel [data-admin-tab]");
const adminTabPanels = document.querySelectorAll("#admin-panel [data-admin-panel]");
const reopenLevelMapBtn = document.getElementById("reopen-level-map");
const resetSessionBtn = document.getElementById("reset-session");

const levelChapterList = document.getElementById("level-chapter-list");
const levelCreateChapterBtn = document.getElementById("level-create-chapter");
const levelCreateSectionBtn = document.getElementById("level-create-section");
const levelChapterStatus = document.getElementById("level-chapter-status");
const levelSectionStatus = document.getElementById("level-section-status");
const chapterEditorForm = document.getElementById("chapter-editor-form");
const chapterEditorTitle = document.getElementById("chapter-editor-title");
const chapterEditorDescription = document.getElementById("chapter-editor-description");
const chapterEditorOrder = document.getElementById("chapter-editor-order");
const levelSaveChapterBtn = document.getElementById("level-save-chapter");
const levelDeleteChapterBtn = document.getElementById("level-delete-chapter");
const sectionEditorForm = document.getElementById("section-editor-form");
const sectionEditorTitle = document.getElementById("section-editor-title");
const sectionEditorDescription = document.getElementById("section-editor-description");
const sectionEditorEnvironment = document.getElementById("section-editor-environment");
const sectionEditorEnvironmentUser = document.getElementById("section-editor-environment-user");
const sectionEditorConversation = document.getElementById("section-editor-conversation");
const sectionEditorEvaluation = document.getElementById("section-editor-evaluation");
const sectionEditorEnvironmentHost = document.getElementById("section-editor-environment-editor");
const sectionEditorConversationHost = document.getElementById("section-editor-conversation-editor");
const sectionEditorEvaluationHost = document.getElementById("section-editor-evaluation-editor");
const sectionEditorBargaining = document.getElementById("section-editor-bargaining");
const sectionEditorOrder = document.getElementById("section-editor-order");
const levelSaveSectionBtn = document.getElementById("level-save-section");
const levelDeleteSectionBtn = document.getElementById("level-delete-section");

const theoryPanel = document.getElementById("theory-panel");
const theoryStatusText = document.getElementById("theory-status");
const theoryTree = document.getElementById("theory-tree");
const theoryLessonTitleEl = document.getElementById("theory-lesson-title");
const theoryLessonCodeEl = document.getElementById("theory-lesson-code");
const theoryLessonContentEl = document.getElementById("theory-lesson-html");
const theoryChallengeContainer = document.getElementById("theory-challenge");
const theoryChallengeTitleEl = document.getElementById("theory-challenge-title");
const theoryChallengeAction = document.getElementById("theory-challenge-action");

const adminTheoryTree = document.getElementById("admin-theory-tree");
const adminTheoryCreateTopicBtn = document.getElementById("admin-theory-create-topic");
const adminTheoryCreateLessonBtn = document.getElementById("admin-theory-create-lesson");
const adminTheoryStatus = document.getElementById("admin-theory-status");
const adminTheoryTopicForm = document.getElementById("admin-theory-topic-form");
const adminTheoryTopicChapter = document.getElementById("admin-theory-topic-chapter");
const adminTheoryTopicCode = document.getElementById("admin-theory-topic-code");
const adminTheoryTopicTitle = document.getElementById("admin-theory-topic-title");
const adminTheoryTopicSummary = document.getElementById("admin-theory-topic-summary");
const adminTheoryTopicOrder = document.getElementById("admin-theory-topic-order");
const adminTheoryTopicDeleteBtn = document.getElementById("admin-theory-topic-delete");
const adminTheoryTopicStatus = document.getElementById("admin-theory-topic-status");
const adminTheoryLessonForm = document.getElementById("admin-theory-lesson-form");
const adminTheoryLessonTopic = document.getElementById("admin-theory-lesson-topic");
const adminTheoryLessonCode = document.getElementById("admin-theory-lesson-code");
const adminTheoryLessonTitle = document.getElementById("admin-theory-lesson-title");
const adminTheoryLessonOrder = document.getElementById("admin-theory-lesson-order");
const adminTheoryLessonSection = document.getElementById("admin-theory-lesson-section");
const adminTheoryLessonDeleteBtn = document.getElementById("admin-theory-lesson-delete");
const adminTheoryLessonStatus = document.getElementById("admin-theory-lesson-status");
const adminTheoryLessonEditorHost = document.getElementById("admin-theory-lesson-editor");
const adminTheoryLessonContent = document.getElementById("admin-theory-lesson-content");

const scenarioTitleEl = document.getElementById("scenario-title");
const scenarioSummaryEl = document.getElementById("scenario-summary");
const studentRoleEl = document.getElementById("student-role");
const studentCompanyEl = document.getElementById("student-company");
const aiRoleEl = document.getElementById("ai-role");
const aiCompanyEl = document.getElementById("ai-company");
const productDetailsEl = document.getElementById("product-details");
const negotiationFocusEl = document.getElementById("negotiation-focus");
const riskListEl = document.getElementById("risk-list");
const taskChecklistEl = document.getElementById("task-checklist");
const chatCompanyEl = document.getElementById("chat-company");
const chatToneEl = document.getElementById("chat-tone");
const chatBodyEl = document.getElementById("chat-body");
const chatInputEl = document.getElementById("chat-input");
const sendMessageBtn = document.getElementById("send-message");
const evaluationScoreEl = document.getElementById("evaluation-score");
const evaluationScoreLabelEl = document.getElementById("evaluation-score-label");
const evaluationCommentaryEl = document.getElementById("evaluation-commentary");
const evaluationActionsEl = document.getElementById("evaluation-actions");
const evaluationKnowledgeEl = document.getElementById("evaluation-knowledge");
const abilityRadarCanvas = document.getElementById("ability-radar");
const abilityRadarEmpty = document.getElementById("ability-radar-empty");
const abilityHistoryList = document.getElementById("ability-history");
const abilityKnowledgeEl = document.getElementById("ability-knowledge");
const scenarioDifficultyEl = document.getElementById("scenario-difficulty");
const scenarioPanel = document.getElementById("scenario-panel");
const scenarioCollapseBtn = document.getElementById("scenario-collapse-btn");
const scenarioPanelBody = document.getElementById("scenario-panel-body");
const scenarioCustomFieldsEl = document.getElementById("scenario-custom-fields");
const experienceModules = document.querySelectorAll("[data-experience-module]");
const experienceTabButtons = document.querySelectorAll(".experience-tab");

const adminTrendList = document.getElementById("admin-trend-list");
const adminActionHotspots = document.getElementById("admin-action-hotspots");
const adminKnowledgeWeakness = document.getElementById("admin-knowledge-weakness");

